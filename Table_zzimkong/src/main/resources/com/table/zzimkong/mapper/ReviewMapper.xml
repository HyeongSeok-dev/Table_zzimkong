<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.table.zzimkong.mapper.ReviewMapper">
	<!-- 리뷰 등록 작업 - INSERT -->
	<!-- 이미지 나머지 파일은 디폴트값 넣기 -->
	<insert id="insertReview"> 
	INSERT 
	INTO review
	VALUES (
	#{review_num}
	,#{user_id}
	,1
	,0
	,1
	,'0'
	,#{review_content}
	,#{review_score}
	,#{review_mood_interior}
	,#{review_mood_alone}
	,#{review_mood_large}
	,#{review_mood_meeting}
	,#{review_mood_view}
	,#{review_food_big}
	,#{review_food_deli}
	,#{review_food_cheap}
	,#{review_food_fresh}
	,#{review_food_healthy}
	,#{review_etc_kind}
	,#{review_etc_parking}
	,#{review_etc_toilet}
	,#{review_etc_fast}
	,#{review_etc_child}
	,#{review_no_keyword}
	,#{review_like}
	,0 
	,now()
	,#{review_img_1}
	,NULL
	,NULL
	,NULL
	,NULL
	,1
	)
	</insert>
	
	<!-- 업체이름 불러오기 -->
	<select id="selectCompanyName" parameterType="int" resultType="String">
	    SELECT com_name
	    FROM company
	    WHERE com_id = #{com_id}
	</select>
	
	<!-- 리뷰 갯수 -->
	<select id="countReview" resultType="int">
	    SELECT COUNT(*)
	    FROM review
	    WHERE com_id = #{com_id}
	</select>

	<!-- 별점 평균 -->
	<select id="averageReview" parameterType="int" resultType="double">
		SELECT ROUND(AVG(review_score)/2,2)
		FROM review
	    WHERE com_id = #{com_id}
	</select>
	
	<!-- 리뷰 리스트 -->
	<select id="allReviewList" parameterType="int" resultType="review">
	    SELECT * 
	    FROM review
	    WHERE com_id = #{com_id}
	    ORDER BY review_update DESC;
	</select>
	
	<!-- 리뷰 수정 -->
	<select id="modifyReview" parameterType="int" resultType="review">
	    SELECT * 
	    FROM review
	    WHERE review_num = #{review_num}
	</select>

	<!-- 글 삭제 - DELETE -->
	<delete id="removeReview" parameterType="int">
		DELETE FROM review
		WHERE review_num = #{review_num}
	</delete>
	
<!-- 		  Board_file1 = DB컬럼명 = review_img_1 -->
<!-- 		 file1 = file1 (= form태그내의 name속성값과 동일) -->
<!-- 		 fileName1 = fileName1 -->
		
	
	<!-- 일치하는 레코드 내의 파일명 삭제(널스트링으로 값 수정) - UPDATE -->
	<update id="updateReviewFile">
		UPDATE review
		SET 
			review_img_1 = CASE WHEN review_img_1 = #{review_img_1} THEN '' ELSE review_img_1 END
		WHERE
			review_num = #{review_num}	
	</update>
	
	<!-- 리뷰 수정(UPDATE) -->
	<update id="updateReview">
	
	</update>
	
	
	<!-- 리뷰 내용 가져오기 -->
	<select id="getReview" parameterType="int" resultType="review">
		SELECT *
		FROM review
		WHERE review_num = #{review_num}
	</select>
	
	
	
	<!-- 이런 점이 좋았어요 -->
<!-- 	<select id="getKeywordCounts" parameterType="int" resultType="map">
	    SELECT 'review_mood_interior' AS keyword, COUNT(*) AS count
    	FROM review
    	WHERE com_id = #{comId} AND review_mood_interior = 1
	    UNION
	    SELECT 'review_mood_alone', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_mood_alone = 1
	    UNION
	    SELECT 'review_mood_large', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_mood_large = 1
	    UNION
	    SELECT 'review_mood_meeting', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_mood_meeting = 1
	    UNION
	    SELECT 'review_mood_view', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_mood_view = 1
	    UNION
	    SELECT 'review_food_big', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_food_big = 1
	    UNION
	    SELECT 'review_food_deli', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_food_deli = 1
	    UNION
	    SELECT 'review_food_cheap', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_food_cheap = 1
	    UNION
	    SELECT 'review_food_fresh', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_food_fresh = 1
	    UNION
	    SELECT 'review_food_healthy', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_food_healthy = 1
	    UNION
	    SELECT 'review_etc_kind', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_etc_kind = 1
	    UNION
	    SELECT 'review_etc_parking', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_etc_parking = 1
	    UNION
	    SELECT 'review_etc_toilet', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_etc_toilet = 1
	    UNION
	    SELECT 'review_etc_fast', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_etc_fast = 1
	    UNION
	    SELECT 'review_etc_child', COUNT(*)
	    FROM review
	    WHERE com_id = #{comId} AND review_etc_child = 1
	</select> -->



</mapper>